<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2048 - Working Final</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            user-select: none;
        }
        body {
            background: #1a2e3f;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }
        .game-container {
            width: min(98vw, 450px);
            background: #2c3e50;
            border-radius: 20px;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .title {
            background: #34495e;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: bold;
        }
        .score-box {
            background: #34495e;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.5rem;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            background: #34495e;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .tile {
            aspect-ratio: 1;
            background: #1e2b38;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            transition: 0.1s;
        }
        .tile-2 { background: #3498db; }
        .tile-4 { background: #2ecc71; }
        .tile-8 { background: #f1c40f; color: #2c3e50; }
        .tile-16 { background: #e67e22; }
        .tile-32 { background: #e74c3c; }
        .tile-64 { background: #9b59b6; }
        .tile-128 { background: #1abc9c; font-size: 1.8rem; }
        .tile-256 { background: #f39c12; font-size: 1.8rem; }
        .tile-512 { background: #d35400; font-size: 1.8rem; }
        .tile-1024 { background: #c0392b; font-size: 1.5rem; }
        .tile-2048 { background: #27ae60; font-size: 1.5rem; }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        button {
            background: #e67e22;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }
        button.reset {
            background: #3498db;
            grid-column: span 3;
        }
    </style>
</head>
<body>
<div class="game-container">
    <div class="header">
        <div class="title">2048</div>
        <div class="score-box" id="score">0</div>
    </div>
    <div class="board" id="board"></div>
    <div class="controls">
        <button id="up">↑</button>
        <button id="down">↓</button>
        <button id="left">←</button>
        <button id="right">→</button>
        <button class="reset" id="reset">⟲</button>
    </div>
</div>

<script>
(function() {
    let grid = Array(4).fill().map(() => Array(4).fill(0));
    let score = 0;
    
    function init() {
        grid = Array(4).fill().map(() => Array(4).fill(0));
        score = 0;
        addNewTile();
        addNewTile();
        render();
    }
    
    function addNewTile() {
        let empty = [];
        for(let r=0; r<4; r++) {
            for(let c=0; c<4; c++) {
                if(grid[r][c] === 0) empty.push({r, c});
            }
        }
        if(empty.length > 0) {
            let pos = empty[Math.floor(Math.random() * empty.length)];
            grid[pos.r][pos.c] = Math.random() < 0.9 ? 2 : 4;
        }
    }
    
    function move(direction) {
        let moved = false;
        let newGrid = Array(4).fill().map(() => Array(4).fill(0));
        
        if(direction === 'left') {
            for(let r=0; r<4; r++) {
                let row = grid[r].filter(v => v !== 0);
                for(let i=0; i<row.length; i++) {
                    if(i < row.length-1 && row[i] === row[i+1]) {
                        row[i] *= 2;
                        score += row[i];
                        row.splice(i+1, 1);
                    }
                }
                for(let c=0; c<row.length; c++) {
                    newGrid[r][c] = row[c];
                }
                if(JSON.stringify(newGrid[r]) !== JSON.stringify(grid[r])) moved = true;
            }
        }
        else if(direction === 'right') {
            for(let r=0; r<4; r++) {
                let row = grid[r].filter(v => v !== 0);
                for(let i=row.length-1; i>0; i--) {
                    if(row[i] === row[i-1]) {
                        row[i] *= 2;
                        score += row[i];
                        row.splice(i-1, 1);
                        i--;
                    }
                }
                for(let c=0; c<row.length; c++) {
                    newGrid[r][3-c] = row[row.length-1-c];
                }
                if(JSON.stringify(newGrid[r]) !== JSON.stringify(grid[r])) moved = true;
            }
        }
        else if(direction === 'up') {
            for(let c=0; c<4; c++) {
                let col = [];
                for(let r=0; r<4; r++) {
                    if(grid[r][c] !== 0) col.push(grid[r][c]);
                }
                for(let i=0; i<col.length; i++) {
                    if(i < col.length-1 && col[i] === col[i+1]) {
                        col[i] *= 2;
                        score += col[i];
                        col.splice(i+1, 1);
                    }
                }
                for(let r=0; r<col.length; r++) {
                    if(newGrid[r][c] !== col[r]) moved = true;
                    newGrid[r][c] = col[r];
                }
            }
        }
        else if(direction === 'down') {
            for(let c=0; c<4; c++) {
                let col = [];
                for(let r=0; r<4; r++) {
                    if(grid[r][c] !== 0) col.push(grid[r][c]);
                }
                for(let i=col.length-1; i>0; i--) {
                    if(col[i] === col[i-1]) {
                        col[i] *= 2;
                        score += col[i];
                        col.splice(i-1, 1);
                        i--;
                    }
                }
                for(let r=0; r<col.length; r++) {
                    if(newGrid[3-r][c] !== col[col.length-1-r]) moved = true;
                    newGrid[3-r][c] = col[col.length-1-r];
                }
            }
        }
        
        if(moved) {
            grid = newGrid;
            addNewTile();
            render();
        }
    }
    
    function render() {
        let boardEl = document.getElementById('board');
        boardEl.innerHTML = '';
        for(let r=0; r<4; r++) {
            for(let c=0; c<4; c++) {
                let tile = document.createElement('div');
                tile.className = `tile tile-${grid[r][c]}`;
                tile.textContent = grid[r][c] || '';
                boardEl.appendChild(tile);
            }
        }
        document.getElementById('score').textContent = score;
    }
    
    document.getElementById('left').onclick = () => move('left');
    document.getElementById('right').onclick = () => move('right');
    document.getElementById('up').onclick = () => move('up');
    document.getElementById('down').onclick = () => move('down');
    document.getElementById('reset').onclick = init;
    
    document.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowLeft') move('left');
        if(e.key === 'ArrowRight') move('right');
        if(e.key === 'ArrowUp') move('up');
        if(e.key === 'ArrowDown') move('down');
    });
    
    init();
})();
</script>
</body>
</html>