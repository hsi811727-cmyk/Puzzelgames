<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON RACER - JOYSTICK CONTROL</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none;
        }
        body { 
            background: #000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            font-family: 'Courier New', monospace;
            touch-action: manipulation;
            padding: 10px;
        }
        .game-container {
            text-align: center;
            width: 100%;
            max-width: 480px;
        }
        canvas { 
            border: 2px solid #0ff; 
            width: 100%; 
            max-width: 480px; 
            height: auto;
            display: block;
            touch-action: none;
            background: #000;
            margin-bottom: 10px;
        }
        .dashboard {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
            color: #0ff;
            background: #111;
            padding: 10px;
            border: 1px solid #0ff;
        }
        #startBtn {
            background: #000;
            color: #0ff;
            border: 2px solid #0ff;
            padding: 15px 30px;
            font-size: 24px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            width: 100%;
            box-shadow: 0 0 10px #0ff;
        }
        #startBtn:active {
            background: #0ff;
            color: #000;
        }
        
        /* JOYSTICK CONTAINER */
        .joystick-container {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            background: #111;
            border: 2px solid #0ff;
            border-radius: 100px;
            box-shadow: 0 0 20px #0ff;
        }
        
        /* JOYSTICK KNOB */
        #joystickKnob {
            width: 80px;
            height: 80px;
            background: #0ff;
            border-radius: 40px;
            position: absolute;
            top: 60px;
            left: 60px;
            box-shadow: 0 0 20px #0ff;
            border: 2px solid #fff;
        }
        
        .joystick-label {
            color: #fff;
            margin-top: 5px;
            font-size: 14px;
        }
        
        .status {
            color: #ff0;
            margin: 10px 0;
            font-size: 18px;
            text-shadow: 0 0 5px #ff0;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="dashboard">
            <span id="speedDisplay">0 km/h</span>
            <span id="lapDisplay">LAP 1/3</span>
            <span id="posDisplay">P1</span>
        </div>
        
        <canvas id="gameCanvas" width="480" height="640"></canvas>
        
        <div class="status" id="statusMessage">üëá USE JOYSTICK BELOW üëá</div>
        
        <!-- JOYSTICK - WORKS ON EVERY ANDROID -->
        <div class="joystick-container" id="joystickArea">
            <div id="joystickKnob"></div>
        </div>
        <div class="joystick-label">TOUCH AND DRAG THE JOYSTICK</div>
        
        <button id="startBtn">üèÅ START RACE üèÅ</button>
    </div>

    <script>
        // Canvas setup
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // ===== JOYSTICK VARIABLES =====
        const joystickArea = document.getElementById('joystickArea');
        const joystickKnob = document.getElementById('joystickKnob');
        
        let joystickActive = false;
        let joystickX = 0;
        let joystickY = 0;
        
        // Joystick center position
        const joystickCenterX = 100;
        const joystickCenterY = 100;
        const joystickMaxDistance = 50;
        
        // ===== JOYSTICK EVENT HANDLERS =====
        joystickArea.addEventListener('touchstart', (e) => {
            e.preventDefault();
            joystickActive = true;
            updateJoystick(e.touches[0]);
        });
        
        joystickArea.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if(joystickActive) {
                updateJoystick(e.touches[0]);
            }
        });
        
        joystickArea.addEventListener('touchend', (e) => {
            e.preventDefault();
            joystickActive = false;
            // Reset joystick to center
            joystickKnob.style.left = '60px';
            joystickKnob.style.top = '60px';
            joystickX = 0;
            joystickY = 0;
        });
        
        joystickArea.addEventListener('touchcancel', (e) => {
            e.preventDefault();
            joystickActive = false;
            // Reset joystick to center
            joystickKnob.style.left = '60px';
            joystickKnob.style.top = '60px';
            joystickX = 0;
            joystickY = 0;
        });
        
        function updateJoystick(touch) {
            const rect = joystickArea.getBoundingClientRect();
            
            // Calculate touch position relative to joystick center
            let touchX = touch.clientX - rect.left - joystickCenterX;
            let touchY = touch.clientY - rect.top - joystickCenterY;
            
            // Calculate distance from center
            let distance = Math.sqrt(touchX * touchX + touchY * touchY);
            
            // Limit to max distance
            if(distance > joystickMaxDistance) {
                touchX = (touchX / distance) * joystickMaxDistance;
                touchY = (touchY / distance) * joystickMaxDistance;
            }
            
            // Update knob position
            joystickKnob.style.left = (60 + touchX) + 'px';
            joystickKnob.style.top = (60 + touchY) + 'px';
            
            // Store joystick values (normalized -1 to 1)
            joystickX = touchX / joystickMaxDistance;
            joystickY = touchY / joystickMaxDistance;
        }
        
        // ===== GAME STATE =====
        let gameRunning = false;
        let raceFinished = false;
        let crashed = false;
        
        // ===== PLAYER =====
        let player = {
            x: 240,
            y: 500,
            width: 20,
            height: 30,
            speed: 0,
            maxSpeed: 6,
            turnSpeed: 3
        };
        
        // ===== TRACK =====
        let trackX = 140;
        let trackWidth = 200;
        
        // ===== OPPONENTS =====
        let opponents = [
            { x: 200, y: 100, speed: 2, active: true },
            { x: 280, y: 200, speed: 2.2, active: true },
            { x: 160, y: 300, speed: 1.8, active: true },
            { x: 320, y: 400, speed: 2.5, active: true }
        ];
        
        // ===== GAME VARIABLES =====
        let lap = 1;
        let position = 1;
        
        // ===== START GAME =====
        function startGame() {
            gameRunning = true;
            raceFinished = false;
            crashed = false;
            
            // Reset player
            player.x = 240;
            player.y = 500;
            player.speed = 0;
            
            // Reset lap
            lap = 1;
            
            // Reset opponents
            opponents = [
                { x: 200, y: 100, speed: 2, active: true },
                { x: 280, y: 200, speed: 2.2, active: true },
                { x: 160, y: 300, speed: 1.8, active: true },
                { x: 320, y: 400, speed: 2.5, active: true }
            ];
            
            document.getElementById('statusMessage').innerText = 'RACING! USE JOYSTICK';
            updateDisplay();
        }
        
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('startBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            startGame();
        });
        
        // ===== UPDATE DISPLAY =====
        function updateDisplay() {
            document.getElementById('speedDisplay').innerText = Math.floor(Math.abs(player.speed * 10)) + ' km/h';
            document.getElementById('lapDisplay').innerText = 'LAP ' + lap + '/3';
            document.getElementById('posDisplay').innerText = 'P' + position;
        }
        
        // ===== GAME UPDATE =====
        function update() {
            if(!gameRunning) return;
            if(raceFinished || crashed) return;
            
            // ===== JOYSTICK CONTROLS =====
            // Y axis: Up = negative, Down = positive
            if(joystickY < -0.2) {
                // Push joystick UP = accelerate
                player.speed = Math.min(player.speed + 0.2, player.maxSpeed);
            } else if(joystickY > 0.2) {
                // Push joystick DOWN = brake/reverse
                player.speed = Math.max(player.speed - 0.3, -2);
            } else {
                // Coast when joystick centered
                player.speed *= 0.98;
            }
            
            // X axis: Left = negative, Right = positive
            if(Math.abs(player.speed) > 0.1) {
                if(joystickX < -0.2) {
                    player.x -= player.turnSpeed;
                }
                if(joystickX > 0.2) {
                    player.x += player.turnSpeed;
                }
            }
            
            // Keep player on track
            if(player.x < trackX + 10) {
                player.x = trackX + 10;
                if(Math.abs(player.speed) > 3) {
                    crashed = true;
                    document.getElementById('statusMessage').innerText = 'üí• CRASH! PRESS START üí•';
                }
            }
            if(player.x > trackX + trackWidth - 10) {
                player.x = trackX + trackWidth - 10;
                if(Math.abs(player.speed) > 3) {
                    crashed = true;
                    document.getElementById('statusMessage').innerText = 'üí• CRASH! PRESS START üí•';
                }
            }
            
            // Move opponents
            opponents.forEach(opp => {
                if(opp.active) {
                    opp.y -= opp.speed;
                    
                    // Reset opponents when they go off screen
                    if(opp.y < -50) {
                        opp.y = 700;
                        opp.speed = 1.5 + Math.random() * 2;
                    }
                    
                    // Collision detection
                    let dx = Math.abs(player.x - opp.x);
                    let dy = Math.abs(player.y - opp.y);
                    
                    if(dx < 25 && dy < 30) {
                        if(player.speed > opp.speed + 1) {
                            opp.y += 50; // Player passes opponent
                        } else {
                            crashed = true;
                            document.getElementById('statusMessage').innerText = 'üí• CRASH! PRESS START üí•';
                        }
                    }
                }
            });
            
            // Lap counting
            if(player.y < 100 && lap === 1) {
                lap = 2;
            } else if(player.y < 100 && lap === 2) {
                lap = 3;
            } else if(player.y < 100 && lap === 3) {
                raceFinished = true;
                document.getElementById('statusMessage').innerText = 'üèÜ RACE FINISHED! üèÜ';
            }
            
            // Position calculation
            let ahead = 1;
            opponents.forEach(opp => {
                if(opp.active && opp.y < player.y) {
                    ahead++;
                }
            });
            position = ahead;
            
            updateDisplay();
        }
        
        // ===== DRAW =====
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Grass
            ctx.fillStyle = '#0a0';
            ctx.fillRect(0, 0, trackX, canvas.height);
            ctx.fillRect(trackX + trackWidth, 0, canvas.width - (trackX + trackWidth), canvas.height);
            
            // Road
            ctx.fillStyle = '#222';
            ctx.fillRect(trackX, 0, trackWidth, canvas.height);
            
            // Road edges
            ctx.strokeStyle = '#0ff';
            ctx.lineWidth = 3;
            ctx.shadowColor = '#0ff';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.moveTo(trackX, 0);
            ctx.lineTo(trackX, canvas.height);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(trackX + trackWidth, 0);
            ctx.lineTo(trackX + trackWidth, canvas.height);
            ctx.stroke();
            
            // Center line
            ctx.strokeStyle = '#fff';
            ctx.setLineDash([10, 20]);
            ctx.beginPath();
            ctx.moveTo(trackX + trackWidth/2, 0);
            ctx.lineTo(trackX + trackWidth/2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Start line
            ctx.fillStyle = '#fff';
            ctx.shadowColor = '#fff';
            ctx.fillRect(trackX + 50, 50, 100, 8);
            
            // Opponents
            opponents.forEach(opp => {
                if(opp.active) {
                    ctx.fillStyle = '#f0f';
                    ctx.shadowColor = '#f0f';
                    ctx.shadowBlur = 15;
                    ctx.fillRect(opp.x - 10, opp.y - 15, 20, 30);
                    
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(opp.x - 5, opp.y - 8, 10, 8);
                }
            });
            
            // Player
            ctx.fillStyle = '#0ff';
            ctx.shadowColor = '#0ff';
            ctx.shadowBlur = 15;
            ctx.fillRect(player.x - 10, player.y - 15, 20, 30);
            
            ctx.fillStyle = '#fff';
            ctx.fillRect(player.x - 5, player.y - 8, 10, 8);
            
            ctx.fillStyle = '#ff0';
            ctx.fillRect(player.x - 8, player.y - 18, 4, 4);
            ctx.fillRect(player.x + 4, player.y - 18, 4, 4);
            
            ctx.shadowBlur = 0;
            
            // Messages
            if(!gameRunning) {
                ctx.font = 'bold 24px "Courier New"';
                ctx.fillStyle = '#ff0';
                ctx.shadowColor = '#ff0';
                ctx.shadowBlur = 15;
                ctx.fillText('PRESS START', 140, 300);
                ctx.shadowBlur = 0;
            }
            
            if(crashed) {
                ctx.font = 'bold 30px "Courier New"';
                ctx.fillStyle = '#f00';
                ctx.shadowColor = '#f00';
                ctx.shadowBlur = 15;
                ctx.fillText('CRASH!', 150, 300);
                ctx.shadowBlur = 0;
            }
            
            if(raceFinished) {
                ctx.font = 'bold 30px "Courier New"';
                ctx.fillStyle = '#ff0';
                ctx.shadowColor = '#ff0';
                ctx.shadowBlur = 15;
                ctx.fillText('FINISH!', 150, 300);
                ctx.font = '20px "Courier New"';
                ctx.fillText('POSITION: ' + position, 130, 350);
                ctx.shadowBlur = 0;
            }
            
            // Scanlines
            ctx.fillStyle = 'rgba(0,0,0,0.1)';
            for(let i = 0; i < canvas.height; i+=4) {
                ctx.fillRect(0, i, canvas.width, 1);
            }
            
            requestAnimationFrame(draw);
        }
        
        // ===== START GAME LOOP =====
        setInterval(update, 1000/60); // 60fps update
        draw(); // Start drawing
    </script>
</body>
</html>